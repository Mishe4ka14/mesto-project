(()=>{"use strict";var e,t,n=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))},o=document.querySelector(".page"),r=o.querySelector(".card-container"),a=document.querySelectorAll(".popup"),c=o.querySelector("#popup"),s=(o.querySelector("#closePopupButton"),o.querySelector("#openPopupButton")),u=o.querySelector(".profile__avatar"),l=document.querySelector(".elements"),i=o.querySelector("#place"),d=(o.querySelector("#closePlaceButton"),o.querySelector("#openPlaceButton")),p=o.querySelector("#addButton"),_=(o.querySelector("#trash"),o.querySelector("#image")),v=(o.querySelector("#closeImageButton"),_.querySelector(".image__image-full")),f=_.querySelector(".image__title"),m=o.querySelector(".popup__field_name"),y=o.querySelector(".popup__field_job"),S=o.querySelector(".profile__title"),h=o.querySelector(".profile__subtitle"),L=null===(e=document.querySelector(".template"))||void 0===e?void 0:e.content,q=o.querySelector("#place-title"),b=o.querySelector("#place-link"),E=document.querySelectorAll(".popup__close-button"),k=document.querySelector(".profile__strelka"),g=document.querySelector("#new-avatar"),C=document.querySelector(".popup__field_avatar"),x=(document.querySelector(".save_avatar"),document.querySelectorAll(".popup__save-button"),document.querySelector("#addAvatar")),B=(o.querySelector("#popup-form"),"54837afe3652a0dc55e19a1e"),A={baseURL:"https://nomoreparties.co/v1/plus-cohort-22",headers:{authorization:"8c2802e0-9b5b-4767-b677-ed23ce66f120","Content-Type":"application/json"}};t={formSelector:".popup__form",inputSelector:".popup__field",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_inactive",inputErrorClass:"popup__field_error",inputErrorType:"popup__field_type_error",errorClass:"popup__field-error_active"},Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n(o,r,t),o.forEach((function(a){a.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),t.classList.remove(n.inputErrorType),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),t.classList.add(o.inputErrorType),r.classList.add(o.errorClass),r.textContent=n}(e,t,t.validationMessage,n)}(e,a,t),n(o,r,t)}))}))}(e,t)}));var T=function(e,t){return fetch(e,t).then(U)},U=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function P(e){"Escape"===e.key&&w(document.querySelector(".popup_opened"))}function R(e){e.classList.add("popup_opened"),document.addEventListener("keydown",P)}function w(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",P)}function D(e,t){var n=t.target.querySelector(".popup__save-button");n.textContent=e?n.dataset.value1:n.value}a.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&w(e),t.target.classList.contains("popup__close")&&w(e)}))}));var j=function(e,t){e.length>0?(t.textContent=e.length,t.classList.add("elements__number-likes_active")):(t.textContent="",t.classList.remove("elements__number-likes_active"))},N=function(e,t){e.forEach((function(e){e._id===B&&t.classList.add("elements__like-button_active")}))};function O(e){var t,n=L.querySelector(".template__element").cloneNode(!0),o=n.querySelector(".elements__photo"),r=n.querySelector(".elements__photo-title"),a=n.querySelector(".elements__number-likes"),c=n.querySelector(".elements__trash-button");return o.src=e.link,o.alt=e.name,r.textContent=e.name,n.querySelector(".elements__trash-button").addEventListener("click",(function(){var t;(t=e._id,T("".concat(A.baseURL,"/cards/").concat(t),{method:"DELETE",headers:A.headers})).then((function(e){n.remove()})).catch((function(e){console.log(e)}))})),n.querySelector(".elements__like-button").addEventListener("click",(function(t){var n;t.target.classList.contains("elements__like-button_active")?(n=e._id,T("".concat(A.baseURL,"/cards/likes/").concat(n),{method:"DELETE",headers:A.headers})).then((function(e){N(e.likes,t.target),j(e.likes,a),t.target.classList.remove("elements__like-button_active")})):function(e){return T("".concat(A.baseURL,"/cards/likes/").concat(e),{method:"PUT",headers:A.headers})}(e._id).then((function(e){N(e.likes,t.target),t.target.classList.add("elements__like-button_active"),j(e.likes,a)}))})),o.addEventListener("click",(function(e){v.src=e.target.src,v.alt=e.target.alt,f.textContent=e.target.alt,R(_)})),N(e.likes,n.querySelector(".elements__like-button")),j(e.likes,a),t=e.owner._id,B!==t&&c.remove(),n}T("".concat(A.baseURL,"/users/me"),{headers:A.headers}).then((function(e){S.textContent=e.name,h.textContent=e.about,u.src=e.avatar})).catch((function(e){console.log(e)})),T("".concat(A.baseURL,"/cards"),{headers:A.headers}).then((function(e){e.forEach((function(e){var t=O(e);r.append(t)}))})),E.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return w(t)}))})),null==s||s.addEventListener("click",(function(){m.value=S.textContent,y.value=h.textContent,R(c)})),null==d||d.addEventListener("click",(function(){R(i)})),null==c||c.addEventListener("submit",(function(e){var t,n;e.preventDefault(),D(!0,e),(t=m.value,n=y.value,T("".concat(A.baseURL,"/users/me"),{method:"PATCH",headers:A.headers,body:JSON.stringify({name:t,about:n})})).then((function(e){S.textContent=e.name,h.textContent=e.about,w(c)})).catch((function(e){console.log(e)})).finally((function(){D(!1,e)}))})),i.addEventListener("submit",(function(e){e.preventDefault(),D(!0,e),function(e,t){return T("".concat(A.baseURL,"/cards"),{method:"POST",headers:A.headers,body:JSON.stringify({name:e,link:t})})}(q.value,b.value).then((function(t){!function(e,t){null==t||t.prepend(e)}(O(t),l),w(i),p.classList.add("popup__save-button_inactive"),e.target.reset()})).catch((function(e){console.log(e)})).finally((function(){D(!1,e)}))})),u.addEventListener("mouseover",(function(){k.classList.add("profile__strelka_active")})),u.addEventListener("mouseout",(function(){k.classList.remove("profile__strelka_active")})),u.addEventListener("mousedown",(function(){R(g)})),k.addEventListener("mousedown",(function(){R(g)})),g.addEventListener("submit",(function(e){var t;e.preventDefault(),D(!0,e),(t=C.value,T("".concat(A.baseURL,"/users/me/avatar"),{method:"PATCH",headers:A.headers,body:JSON.stringify({avatar:t})})).then((function(t){u.src=t.avatar,w(g),x.classList.add("popup__save-button_inactive"),e.target.reset()})).catch((function(e){console.log(e)})).finally((function(){D(!1,e)}))}))})();