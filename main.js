(()=>{"use strict";var e,t,n=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))},r=document.querySelector(".page"),o=r.querySelector(".card-container"),a=document.querySelectorAll(".popup"),c=r.querySelector("#popup"),u=(r.querySelector("#closePopupButton"),r.querySelector("#openPopupButton")),l=r.querySelector(".profile__avatar"),i=document.querySelector(".elements"),s=r.querySelector("#place"),d=(r.querySelector("#closePlaceButton"),r.querySelector("#openPlaceButton")),p=r.querySelector("#addButton"),f=(r.querySelector("#trash"),r.querySelector("#image")),m=(r.querySelector("#closeImageButton"),f.querySelector(".image__image-full")),_=f.querySelector(".image__title"),v=r.querySelector(".popup__field_name"),y=r.querySelector(".popup__field_job"),h=r.querySelector(".profile__title"),S=r.querySelector(".profile__subtitle"),b=null===(e=document.querySelector(".template"))||void 0===e?void 0:e.content,L=r.querySelector("#place-title"),q=r.querySelector("#place-link"),E=document.querySelectorAll(".popup__close-button"),g=document.querySelector(".profile__strelka"),k=document.querySelector("#new-avatar"),C=document.querySelector(".popup__field_avatar"),A=(document.querySelector(".save_avatar"),document.querySelectorAll(".popup__save-button"),document.querySelector("#addAvatar")),x=document.forms.popup_form,w=document.forms.place_form,B=document.forms.avatar_form,T=[],U={baseURL:"https://nomoreparties.co/v1/plus-cohort-22",headers:{authorization:"8c2802e0-9b5b-4767-b677-ed23ce66f120","Content-Type":"application/json"}};t={formSelector:".popup__form",inputSelector:".popup__field",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_inactive",inputErrorClass:"popup__field_error",inputErrorType:"popup__field_type_error",errorClass:"popup__field-error_active"},Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n(r,o,t),r.forEach((function(a){a.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),t.classList.remove(n.inputErrorType),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),t.classList.add(r.inputErrorType),o.classList.add(r.errorClass),o.textContent=n}(e,t,t.validationMessage,n)}(e,a,t),n(r,o,t)}))}))}(e,t)}));var P=function(e,t){return fetch(e,t).then(j)},j=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},R=function(){return P("".concat(U.baseURL,"/cards"),{headers:U.headers})};function O(e){"Escape"===e.key&&I(document.querySelector(".popup_opened"))}function D(e){e.classList.add("popup_opened"),document.addEventListener("keydown",O)}function I(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",O)}function M(e,t){var n=t.target.querySelector(".popup__save-button");n.textContent=e?n.dataset.value1:n.value}a.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&I(e),t.target.classList.contains("popup__close")&&I(e)}))}));var N=function(e,t){e.length>0?(t.textContent=e.length,t.classList.add("elements__number-likes_active")):(t.textContent="",t.classList.remove("elements__number-likes_active"))},J=function(e,t){e.forEach((function(e){e._id===T.id&&t.classList.add("elements__like-button_active")}))};function H(e){var t,n,r=b.querySelector(".template__element").cloneNode(!0),o=r.querySelector(".elements__photo"),a=r.querySelector(".elements__photo-title"),c=r.querySelector(".elements__number-likes"),u=r.querySelector(".elements__trash-button");return o.src=e.link,o.alt=e.name,a.textContent=e.name,r.querySelector(".elements__trash-button").addEventListener("click",(function(){var t;(t=e._id,P("".concat(U.baseURL,"/cards/").concat(t),{method:"DELETE",headers:U.headers})).then((function(e){r.remove()})).catch((function(e){console.log(e)}))})),r.querySelector(".elements__like-button").addEventListener("click",(function(t){var n;t.target.classList.contains("elements__like-button_active")?(n=e._id,P("".concat(U.baseURL,"/cards/likes/").concat(n),{method:"DELETE",headers:U.headers})).then((function(e){J(e.likes,t.target),N(e.likes,c),t.target.classList.remove("elements__like-button_active")})):function(e){return P("".concat(U.baseURL,"/cards/likes/").concat(e),{method:"PUT",headers:U.headers})}(e._id).then((function(e){J(e.likes,t.target),N(e.likes,c)}))})),o.addEventListener("click",(function(e){m.src=e.target.src,m.alt=e.target.alt,_.textContent=e.target.alt,D(f)})),J(e.likes,r.querySelector(".elements__like-button")),N(e.likes,c),t=e.owner._id,n=u,T.id!==t&&n.remove(),r}function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Promise.all([P("".concat(U.baseURL,"/users/me"),{headers:U.headers}),R()]).then((function(e){var t,n,r=(t=e,n=1,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,c,u=[],l=!0,i=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(u.push(r.value),u.length!==t);l=!0);}catch(e){i=!0,o=e}finally{try{if(!l&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(i)throw o}}return u}}(t,n)||function(e,t){if(e){if("string"==typeof e)return V(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?V(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0];h.textContent=r.name,S.textContent=r.about,l.src=r.avatar,T.id=r._id})).then((function(){R().then((function(e){e.forEach((function(e){var t=H(e);o.append(t)}))}))})).catch((function(e){console.log(e)})),E.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return I(t)}))})),null==u||u.addEventListener("click",(function(){v.value=h.textContent,y.value=S.textContent,D(c)})),null==d||d.addEventListener("click",(function(){D(s)})),null==x||x.addEventListener("submit",(function(e){e.preventDefault(),M(!0,e),function(e,t){return P("".concat(U.baseURL,"/users/me"),{method:"PATCH",headers:U.headers,body:JSON.stringify({name:e,about:t})})}(v.value,y.value).then((function(e){h.textContent=e.name,S.textContent=e.about,I(c)})).catch((function(e){console.log(e)})).finally((function(){M(!1,e)}))})),w.addEventListener("submit",(function(e){e.preventDefault(),M(!0,e),function(e,t){return P("".concat(U.baseURL,"/cards"),{method:"POST",headers:U.headers,body:JSON.stringify({name:e,link:t})})}(L.value,q.value).then((function(t){!function(e,t){null==t||t.prepend(e)}(H(t),i),I(s),p.classList.add("popup__save-button_inactive"),p.disabled=!0,e.target.reset()})).catch((function(e){console.log(e)})).finally((function(){M(!1,e)}))})),l.addEventListener("mouseover",(function(){g.classList.add("profile__strelka_active")})),l.addEventListener("mouseout",(function(){g.classList.remove("profile__strelka_active")})),l.addEventListener("mousedown",(function(){D(k)})),g.addEventListener("mousedown",(function(){D(k)})),B.addEventListener("submit",(function(e){var t;e.preventDefault(),M(!0,e),(t=C.value,P("".concat(U.baseURL,"/users/me/avatar"),{method:"PATCH",headers:U.headers,body:JSON.stringify({avatar:t})})).then((function(t){l.src=t.avatar,I(k),A.classList.add("popup__save-button_inactive"),A.disabled=!0,e.target.reset()})).catch((function(e){console.log(e)})).finally((function(){M(!1,e)}))}))})();